#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ Doom II AI –ø—Ä–æ–µ–∫—Ç–∞

# –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
PROJECT_DIR="."
VENV_DIR="venv"

# –ü—É—Ç—å –∫ WAD —Ñ–∞–π–ª—É
WAD_FILE="$PROJECT_DIR/conquest.wad"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∞–π–ª–æ–≤
if [ ! -f "$WAD_FILE" ]; then
    echo "‚ùå –§–∞–π–ª WAD ($WAD_FILE) –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–º–µ—Å—Ç–∏—Ç–µ conquest.wad –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞."
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
if [ ! -d "$VENV_DIR" ]; then
    echo "üîß –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
    python3 -m venv $VENV_DIR
fi

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source $VENV_DIR/bin/activate

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
pip install --upgrade pip
pip install -r $PROJECT_DIR/requirements.txt

# –ó–∞–ø—Ä–æ—Å —Ä–µ–∂–∏–º–∞ –∑–∞–ø—É—Å–∫–∞
echo "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –∑–∞–ø—É—Å–∫–∞:"
echo "1) –ë–æ—Ç (–ò–ò –∏–≥—Ä–∞–µ—Ç)"
echo "2) –ò–≥—Ä–æ–∫ (–í—ã —É–ø—Ä–∞–≤–ª—è–µ—Ç–µ)"
read -p "–í–≤–µ–¥–∏—Ç–µ 1 –∏–ª–∏ 2: " mode_choice

if [ "$mode_choice" == "1" ]; then
    MODE="bot"
elif [ "$mode_choice" == "2" ]; then
    MODE="player"
else
    echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞!"
    deactivate
    exit 1
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
echo "üöÄ –ó–∞–ø—É—Å–∫ Doom II –≤ —Ä–µ–∂–∏–º–µ $MODE ..."
cd $PROJECT_DIR
python3 main.py --mode $MODE

# –í—ã—Ö–æ–¥ –∏–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
deactivate
